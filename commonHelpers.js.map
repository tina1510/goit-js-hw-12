{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport axios from \"axios\";\n\nconst form = document.querySelector(\"form\");\nconst gallery = document.querySelector('.gallery');\nconst loader = document.querySelector('.loader');\nconst loadBtn = document.querySelector('.button-load');\n\n\nfunction showLoader() {\n    loader.classList.remove('hidden');\n}\n\nfunction hideLoader() {\n    loader.classList.add('hidden');\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () =>\n{\n    loadBtn.classList.add(\"hidden\");\n    hideLoader()\n}\n)\n\nconst fetchImages = async ({ query = \"\", page = 1, perPage = 40 }) => {\n    const searchParams = new URLSearchParams({\n        key: `41516813-c0516a6d5bb80b940f21213c5`,\n        q: query,\n        image_type: `photo`,\n        orientation: `horizontal`,\n        safesearch: true,\n        page: page,\n        per_page: perPage,\n    });\n\n    try {\n        const response = await axios.get(`https://pixabay.com/api/?${searchParams}`)\n        return response.data;\n    } catch (error) {\n        console.error(error);\n    }\n}\n\nlet isLastPage = false; \n\nconst createImageRequest = (query) => {\n    let firstPage = 1;\n    const perPage = 40;\n\n    return async () => {\n        try {\n            const { hits, total } = await fetchImages({ page: firstPage, perPage, query});\n\n            if (firstPage >= Math.ceil(total / perPage)) {\n                isLastPage = true;\n            }\n        \n            firstPage += 1;\n\n            return hits;\n        } catch (error) {\n            console.error(error);\n        }\n    };\n}\n\nlet doFetch = null;\n\n\n\nform.addEventListener(\"submit\", async (event) => {\n    event.preventDefault();\n  const query = event.currentTarget.elements.query.value;\n    gallery.innerHTML = \"\";\n    isLastPage = false;\n\n\n\n    if (doFetch !== null) {\n        loadBtn.removeEventListener(\"click\", doFetch);\n    }\n\n    const fetchHits = createImageRequest(query);\n    doFetch = async () => {\n        showLoader();\n       \n        const images = await fetchHits();\n        await renderImages(images);\n        hideLoader();\n    };\n    await doFetch();\n    \n\n    loadBtn.addEventListener(\"click\", async () =>{\n\n       await doFetch()\n         const elem = document.querySelector(\".gallery-item\");\n        const rect = elem.getBoundingClientRect().height;\n        await window.scrollBy(0, rect * 2);\n    }\n     );\n});\n\n\n\nfunction generateImageGalleryMarkup(images) {\n    const imageHTML = images.reduce((html, { webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => {\n        return html + `\n            <div class=\"gallery-item\">\n                <a href=\"${largeImageURL}\" data-lightbox=\"image\">\n                    <img src=\"${webformatURL}\" data-source=\"${largeImageURL}\" alt=\"${tags}\">\n                </a>\n                <div class=\"text-container\">\n                    <div class=\"text-item\"><p class=\"text\">Likes:</p>\n                        <p class=\"likes\"> ${likes}</p></div>\n                    <div class=\"text-item\"> <p class=\"text\">Views: </p>\n                        <p class=\"views\">${views}</p></div>\n                    <div class=\"text-item\"> <p class=\"text\">Comments:</p>\n                        <p class=\"comments\"> ${comments}</p></div>\n                    <div class=\"text-item\"><p class=\"text\">Downloads:</p>\n                        <p class=\"downloads\"> ${downloads}</p></div>\n                </div>\n            </div>`;\n    }, '');\n    gallery.insertAdjacentHTML(\"beforeend\", imageHTML); \n}\n\nasync function renderImages(images) {\n    try {\n\n        if (images.length === 0) {\n            iziToast.error({\n                message: `Sorry, there are no images matching your search query. Please try again!`,\n                position: 'topRight',\n            });\n        } else {\n            generateImageGalleryMarkup(images);\n            const lightbox = new SimpleLightbox('.gallery a', {});\n            lightbox.refresh();\n            if (isLastPage) {\n                loadBtn.classList.add(\"hidden\");\n                iziToast.info({\n                    message: `We're sorry, but you've reached the end of search results.`,\n                    position: 'topRight',\n                });\n            } else {\n                loadBtn.classList.remove(\"hidden\");\n            }\n        }\n    } catch (error) {\n        hideLoader();\n        iziToast.error({\n            message: `Error`,\n            position: 'topRight',\n        });\n        throw new Error(`Error`);\n    }\n    \n}\n\n"],"names":["form","gallery","loader","loadBtn","showLoader","hideLoader","fetchImages","query","page","perPage","searchParams","axios","error","isLastPage","createImageRequest","firstPage","hits","total","doFetch","event","fetchHits","images","renderImages","rect","generateImageGalleryMarkup","imageHTML","html","webformatURL","largeImageURL","tags","likes","views","comments","downloads","iziToast","SimpleLightbox"],"mappings":"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"}